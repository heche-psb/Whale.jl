<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API · Whale.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Whale.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Introduction</a></li><li><a class="toctext" href="../manual/">Manual</a></li><li class="current"><a class="toctext" href>API</a><ul class="internal"></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>API</a></li></ul><a class="edit-page" href="https://github.com/arzwa/Whale.jl/blob/master/docs/src/api.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>API</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="API-1" href="#API-1">API</a></h1><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.CCD" href="#Whale.CCD"><code>Whale.CCD</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">CCD{&lt;:Real,RecTree}</code></pre><p>Conditional clade distribution with many helper fields. See <a href="#Whale.read_ale-Tuple{String,SlicedTree}"><code>read_ale</code></a> for details on IO.</p><pre><code class="language-julia-repl">julia&gt; x
CCD{Float64,PhyloTrees.RecTree}(13 taxa, 83 clades, 5001 samples)

julia&gt; x.ccp
Dict{Tuple,Float64} with 203 entries:
  (83, 65, 66) =&gt; 0.014797
  (46, 6, 60)  =&gt; 0.0185963
  (25, 16, 23) =&gt; 1.0
  (43, 7, 38)  =&gt; 0.995601
  ⋮            =&gt; ⋮

julia&gt; Whale.get_triples(x, 68)
3-element Array{Tuple{Int64,Int64,Int64},1}:
 (24, 75, 1)
 (2, 74, 22)
 (6, 36, 103)</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/ccd.jl#L11-L35">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.GBMModel" href="#Whale.GBMModel"><code>Whale.GBMModel</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">GBMModel(st::SlicedTree, ν::T, η::T, λ::T, μ::T, q::T) where
    T::Union{&lt;:Distribution,Array{&lt;:Distribution,1},&lt;:Real}</code></pre><p>Hierarchical model for Whale using a GBM prior.</p><ul><li><code>ν</code>: autocorrelation strength (variance of geometric Brownian motion)</li><li><code>η</code>: parameter of geometric prior on the number of genes at the root of the species tree S</li><li><code>λ</code>: duplication rate at the root of S</li><li><code>μ</code>: loss rate at the root of S</li><li><code>q</code>: retention rates</li></ul><p>Example: InverseGamma prior on <code>ν</code>, Beta prior on <code>η</code>, Exponential priors on <code>λ</code> and <code>μ</code> at the root and Beta(1,1) priors on the retention rates <code>q</code>.</p><pre><code class="language-julia-repl">julia&gt; m = GBMModel(st, InverseGamma(15), Beta(10, 1), Exponential(1), Exponential(1), [Beta(1,1) for i=1:nwgd(st)]);

julia&gt; rand(m, st)  # sample a state from the prior
Dict{Symbol,Union{Float64, Array{Float64,1}}} with 5 entries:
  :ν =&gt; 0.0771695
  :μ =&gt; [0.498764, 0.500195, 0.459161, 0.615959, 0.482646, 0.502002, 0.402976, 0.354524, 0.378785, …
  :λ =&gt; [0.760383, 0.733029, 0.696493, 0.592979, 0.718899, 1.01307, 0.642244, 0.639109, 0.600577, 0…
  :η =&gt; 0.915222
  :q =&gt; [0.761553, 0.729741, 0.116805, 0.278579, 0.200221, 0.293774, 0.869646]</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/mcmc.jl#L19-L45">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.IRModel" href="#Whale.IRModel"><code>Whale.IRModel</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">IRModel(st::SlicedTree, ν::T, η::T, λ::T, μ::T, q::T) where
    T::Union{&lt;:Distribution,Array{&lt;:Distribution,1},&lt;:Real}</code></pre><p>Hierarchical model for Whale using a independent rates prior. As <a href="#Whale.GBMModel"><code>GBMModel</code></a> but <code>ν</code> is the variance of the log-Normal prior on the branch-wise rates.</p><p>Example:</p><pre><code class="language-julia-repl">julia&gt; m = IRModel(st, InverseGamma(10), Beta(6,3));

julia&gt; m.ν
InverseGamma{Float64}(
invd: Gamma{Float64}(α=10.0, θ=1.0)
θ: 1.0
)

julia&gt; m.λ
Exponential{Float64}(θ=1.0)

julia&gt; rand(m, st)
Dict{Symbol,Union{Float64, Array{Float64,1}}} with 5 entries:
  :ν =&gt; 0.0955299
  :μ =&gt; [0.456988, 0.43639, 0.626645, 0.464031, 0.540543, 0.629841, 0.574996, 0.498506, 0.428841, 0…
  :λ =&gt; [0.498921, 0.69414, 0.54769, 0.533595, 0.521085, 0.515748, 0.534503, 0.594045, 0.583829, 0.…
  :η =&gt; 0.486934
  :q =&gt; [0.970779, 0.965934, 0.788127, 0.405944, 0.827755, 0.253859, 0.395734]</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/mcmc.jl#L87-L116">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.SlicedTree" href="#Whale.SlicedTree"><code>Whale.SlicedTree</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">SlicedTree(tree::Arboreal, wgdconf=Dict(), Δt=0.05, minn=5, maxn=Inf)</code></pre><p>Sliced species tree with optional WGD nodes. WGDs are specified using a configuration dict such as for example:</p><pre><code class="language-julia">wgdconf = Dict(
    &quot;PPAT&quot; =&gt; (&quot;PPAT&quot;, 0.655),
    &quot;CPAP&quot; =&gt; (&quot;CPAP&quot;, 0.275),
    &quot;BETA&quot; =&gt; (&quot;ATHA&quot;, 0.55),
    &quot;ANGI&quot; =&gt; (&quot;ATRI,ATHA&quot;, 3.08),
    &quot;SEED&quot; =&gt; (&quot;GBIL,ATHA&quot;, 3.9),
    &quot;MONO&quot; =&gt; (&quot;OSAT&quot;, 0.91),
    &quot;ALPH&quot; =&gt; (&quot;ATHA&quot;, 0.501))</code></pre><p>where the keys are WGD IDs (names), and values are given as a tuple or array with as first entry a single taxon or pair of taxa (comma-separated) that specifies the last common ancestor node that is preceded by the WGD of interest and the second entry the estimate time (before present) of the WGD event. <code>Δt</code> is the desired slice length (time interval), <code>minn</code> the minimum number of slices a branch should have, and <code>maxn</code> the maximum number of slices a branch should have.</p></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/slicedtree.jl#L4-L21">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.WhaleChain" href="#Whale.WhaleChain"><code>Whale.WhaleChain</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">WhaleChain(st::SlicedTree, π::Model)</code></pre><p>Chain object for performing MCMC under various hierarchical models defined in Whale.</p><pre><code class="language-julia-repl">julia&gt; w = WhaleChain(st, IRModel(st))
WhaleChain{IRModel}(SlicedTree(9, 17, 7))

julia&gt; w[:q]  # current state&#39;s q values
7-element Array{Float64,1}:
 0.4068351791361286
 0.5893350551453437
 0.21472854312451684
 0.8068526003250731
 0.05239284527812649
 0.8432325466244709
 0.9006557436550706

julia&gt; w[:μ, 3]  # current state of μ for branch 3
0.6578486200316909

julia&gt; logpdf(w)  # prior logpdf
59.40417835345352

julia&gt; logpdf(w, :ν=&gt;0.1)  # prior logpdf, but with ν = 0.1
58.49660562613573

julia&gt; logpdf(w, :η=&gt;0.2)  # prior logpdf, but with η = 0.2
45.22412219063766

julia&gt; WhaleModel(w)  # WhaleModel corresponding to current state of the chain
WhaleModel{Float64,CCD}(
λ: [0.440648, 0.486472, 0.412741, 0.432659, 0.392268, 0.485483, 0.485181, 0.422687, 0.431686, 0.477667, 0.405392, 0.414238, 0.442341, 0.390893, 0.429505, 0.41379, 0.435038]
μ: [0.635544, 0.575146, 0.657849, 0.657189, 0.626361, 0.668117, 0.619245, 0.600366, 0.682475, 0.570257, 0.58954, 0.576526, 0.6966, 0.729826, 0.561087, 0.614903, 0.668041]
q: [0.406835, 0.589335, 0.214729, 0.806853, 0.0523928, 0.843233, 0.900656]
η: 0.966691254252368</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/mcmc.jl#L195-L234">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.WhaleModel" href="#Whale.WhaleModel"><code>Whale.WhaleModel</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">WhaleModel{T&lt;:Real,CCD}(S::SlicedTree, λ, μ, q, η=0.9, cond=&quot;oib&quot;)</code></pre><p>The Whale probabilistic model, containing both the sliced species tree, parameters and fields for extinction and propagation probabilities.</p><pre><code class="language-julia-repl">julia&gt; st = Whale.example_tree();

julia&gt; ccd = read_ale(&quot;example/example-ale/&quot;, st);
[ Info:  .. read 12 ALE files

julia&gt; w = WhaleModel(st, 0.2, 0.3, 0.1, 0.9)
WhaleModel{Float64,CCD}(
λ: [0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2]
μ: [0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3]
q: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
η: 0.9
)

julia&gt; logpdf(w, ccd)
-296.67809475568924

julia&gt; ccd[1].tmpmat  # this did not store the dynamic programming (DP) matrix
Dict{Int64,Array{Float64,2}} with 0 entries

julia&gt; logpdf(w, ccd, matrix=true)  # this will store the DP matrix
-296.67809475568924

julia&gt; ccd[1].tmpmat  # this is the DP matrix, required for backtracking
Dict{Int64,Array{Float64,2}} with 24 entries:
  1  =&gt; [0.000160506; 0.00276326; … ; 6.63525e-24; 4.18032e-15]
  2  =&gt; [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]
  16 =&gt; [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]
  ...</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/core.jl#L14-L50">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.backtrack!" href="#Whale.backtrack!"><code>Whale.backtrack!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">backtrack!(ccd::CCD, w::WhaleModel, n=1)
backtrack!(D::CCDArray, w::WhaleModel, n=1)
backtrack!(D::CCDArray, w::WhaleChain, n=1000)
backtrack!(D::CCDArray, df::DataFrame, st::SlicedTree, n=1000)</code></pre><p>Sample reconciled trees (<code>RecTree</code>) from the Whale model conditional on the conditional clade distribution (CCD) by stochastic backtracking along the dynamic programming matrix as in Szollosi 2013. If the <code>recmat</code> field of the <code>ccd</code> argument is non-empty, this matrix will be used, otherwise the reconciliation matrix is computed from scratch. Reconciled trees are stored in the CCD object for convenience.</p><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"><p>If the second argument is a <code>WhaleChain</code> object (or data frame), than <em>post hoc</em> backtracking is performed, that is, reconciled trees are simulated from the posterior predictive distribution after running an MCMC chain.</p></div></div></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/backtrack.jl#L2-L19">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.consensus" href="#Whale.consensus"><code>Whale.consensus</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">consensus(x::CCD, S::SlicedTree)
consensus(D::DArray, S::SlicedTree)</code></pre><p>Get consensus trees from the backtracked <code>RecTree</code>s in the <code>rectrs</code> field of the conditional clade distribution object(s) (CCD).</p><div class="admonition warning"><div class="admonition-title">Warning</div><div class="admonition-text"><p>Branch lengths are not yet correct (they are meaningfully related to the true branch length estimates nevertheless).</p></div></div><div class="admonition warning"><div class="admonition-title">Warning</div><div class="admonition-text"><p>A consensus reconciled tree does not include loss events. This is because different reconciled trees for the same family can have different numbers of loss events.</p></div></div></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/consensus.jl#L1-L16">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.contreetable-Tuple{IO,PhyloTrees.ConRecTree,SlicedTree}" href="#Whale.contreetable-Tuple{IO,PhyloTrees.ConRecTree,SlicedTree}"><code>Whale.contreetable</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-none">contreetable([io::IO,] contree::ConRecTree, S::SlicedTree)</code></pre><p>Write a table representation of a consensus reconciled tree.</p></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/consensus.jl#L102-L106">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.describe-Tuple{WhaleModel}" href="#Whale.describe-Tuple{WhaleModel}"><code>Whale.describe</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-none">describe(w::WhaleModel)</code></pre><p>Get a detailed description of a particular <code>WhaleModel</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/core.jl#L329-L333">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.mcmc!-Tuple{WhaleChain,DistributedArrays.DArray{CCD,1,Array{CCD,1}},Int64,Vararg{Any,N} where N}" href="#Whale.mcmc!-Tuple{WhaleChain,DistributedArrays.DArray{CCD,1,Array{CCD,1}},Int64,Vararg{Any,N} where N}"><code>Whale.mcmc!</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-none">mcmc!(w::WhaleChain, D::CCDArray, n::Int64, args...; kwargs...)</code></pre><p>Perform <code>n</code> generations of MCMC sampling for a <code>WhaleChain</code> given a bunch of observed CCDs.</p></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/mcmc.jl#L292-L297">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.mle" href="#Whale.mle"><code>Whale.mle</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">mle(w::WhaleModel, ccd::CCDArray, optimizer=LBFGS(); kwargs...)</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/mle.jl#L2-L4">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.read_ale-Tuple{String,SlicedTree}" href="#Whale.read_ale-Tuple{String,SlicedTree}"><code>Whale.read_ale</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-none">read_ale(fname::String, s::SlicedTree)</code></pre><p>Read in a bunch of conditional clade distributions (CCD) from ALEobserve (<code>.ale</code>) files. Either provide</p><ul><li>a file with a filename on each line</li><li>a directory with <code>.ale</code> files</li><li>a single <code>.ale</code> file</li><li>an empty file, for running MCMC under the prior alone</li></ul><pre><code class="language-julia-repl">julia&gt; st = Whale.example_tree()
SlicedTree(9, 17, 7)

julia&gt; ccd = read_ale(&quot;example/example-ale/&quot;, st)
[ Info:  .. read 12 ALE files
12-element DistributedArrays.DArray{CCD,1,Array{CCD,1}}:
 CCD{Float64,PhyloTrees.RecTree}(13 taxa, 83 clades, 5001 samples)
 CCD{Float64,PhyloTrees.RecTree}(13 taxa, 55 clades, 5001 samples)
 CCD{Float64,PhyloTrees.RecTree}(13 taxa, 89 clades, 5001 samples)
 CCD{Float64,PhyloTrees.RecTree}(13 taxa, 131 clades, 5001 samples)
 CCD{Float64,PhyloTrees.RecTree}(13 taxa, 107 clades, 5001 samples)
 CCD{Float64,PhyloTrees.RecTree}(13 taxa, 59 clades, 5001 samples)
 CCD{Float64,PhyloTrees.RecTree}(13 taxa, 53 clades, 5001 samples)
 CCD{Float64,PhyloTrees.RecTree}(13 taxa, 83 clades, 5001 samples)
 CCD{Float64,PhyloTrees.RecTree}(13 taxa, 59 clades, 5001 samples)
 CCD{Float64,PhyloTrees.RecTree}(13 taxa, 95 clades, 5001 samples)
 CCD{Float64,PhyloTrees.RecTree}(13 taxa, 67 clades, 5001 samples)
 CCD{Float64,PhyloTrees.RecTree}(13 taxa, 65 clades, 5001 samples)</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/ccd.jl#L73-L104">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Whale.GeometricBrownianMotion" href="#Whale.GeometricBrownianMotion"><code>Whale.GeometricBrownianMotion</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">GeometricBrownianMotion{T&lt;:Real}
GBM(t::SlicedTree, r::T, v::T) where {T&lt;:Real}</code></pre><p>Distribution induced by a Geometric Brownian Motion (GBM) over the SlicedTree. <code>r</code> is the value at the root of the tree, <code>ν</code> is the variance (autocorrelation strength).</p><p>The log density for the GBM distribution is computed with an implementation of the GBM prior on rates based on Ziheng Yang&#39;s MCMCTree, described in <a href="https://academic.oup.com/sysbio/article/56/3/453/1657118">Rannala &amp; Yang (2007)</a>. This uses the approach whereby rates are defined for midpoints of branches, and where a correction is performed to ensure that the correlation is proper (in contrast with Thorne et al. 1998).</p></div></div><a class="source-link" target="_blank" href="https://github.com/arzwa/Whale.jl/blob/13de9146215caa42e9fdfb18a9e6a019b681431e/src/gbm.jl#L1-L15">source</a></section><footer><hr/><a class="previous" href="../manual/"><span class="direction">Previous</span><span class="title">Manual</span></a></footer></article></body></html>
